{"version":3,"sources":["file:///Users/songxiangying/Library/Containers/com.tencent.xinWeChat/Data/Documents/xwechat_files/wxid_4kr9sthln3gq22_cb54/msg/file/2025-11/cc123/assets/core/VwUi.ts"],"names":["_decorator","Component","Label","Button","Sprite","VwFunland","EventMng","VwExchange","VwAddGlass","ccclass","menu","property","VwUi","reset","info","levelLabel","string","level","toString","on","handleCompletePour","exchangeView","node","active","onDestroy","offTarget","updateUndoDisplayState","undoButton","isValid","canUndo","funlandView","undoStack","length","interactable","sprite","getComponent","grayscale","handleProp","_","propName","show","handleUndo","addGlassView"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQQA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,M,OAAAA,M;;AAErCC,MAAAA,S,iBAAAA,S;;AACFC,MAAAA,Q;;AACEC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,U,iBAAAA,U;;;;;;AAbT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;OAQM;AAACC,QAAAA,OAAD;AAAUC,QAAAA,IAAV;AAAgBC,QAAAA;AAAhB,O,GAA4BX,U;;sBAIrBY,I,WAFZH,OAAO,CAAC,MAAD,C,UACPC,IAAI,CAAC,UAAD,C,UAGAC,QAAQ,CAACT,KAAD,C,UAGRS,QAAQ;AAAA;AAAA,iC,UAGRA,QAAQ,CAACR,MAAD,C,UAGRQ,QAAQ;AAAA;AAAA,mC,UAGRA,QAAQ;AAAA;AAAA,mC,0CAhBb,MAEaC,IAFb,SAE0BX,SAF1B,CAEoC;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AAiBzBY,QAAAA,KAAK,CAACC,IAAD,EAAqB;AAC7B,eAAKC,UAAL,CAAgBC,MAAhB,GAAyB,MAAM,CAACF,IAAI,CAACG,KAAL,GAAa,CAAd,EAAiBC,QAAjB,EAAN,GAAoC,GAA7D;AACA;AAAA;AAAA,oCAASC,EAAT,CAAY,cAAZ,EAA4B,KAAKC,kBAAjC,EAAqD,IAArD;;AACA,cAAI,KAAKC,YAAT,EAAuB;AACnB,iBAAKA,YAAL,CAAkBC,IAAlB,CAAuBC,MAAvB,GAAgC,KAAhC;AACH;AACJ;;AAESC,QAAAA,SAAS,GAAG;AAClB;AAAA;AAAA,oCAASC,SAAT,CAAmB,IAAnB;AACH;;AAESL,QAAAA,kBAAkB,GAAG;AAC3B,eAAKM,sBAAL;AACH,SA/B+B,CAiChC;;;AACMA,QAAAA,sBAAsB,GAAG;AAC/B;AACA,cAAI,CAAC,KAAKC,UAAN,IAAoB,CAAC,KAAKA,UAAL,CAAgBL,IAArC,IAA6C,CAAC,KAAKK,UAAL,CAAgBL,IAAhB,CAAqBM,OAAvE,EAAgF;AAC5E;AACH,WAJ8B,CAM/B;;;AACA,gBAAMC,OAAO,GAAG,KAAKC,WAAL,CAAiBC,SAAjB,IAA8B,KAAKD,WAAL,CAAiBC,SAAjB,CAA2BC,MAA3B,GAAoC,CAAlF;AAEA,eAAKL,UAAL,CAAgBM,YAAhB,GAA+BJ,OAA/B;AAEA,gBAAMK,MAAM,GAAG,KAAKP,UAAL,CAAgBL,IAAhB,CAAqBa,YAArB,CAAkC/B,MAAlC,CAAf;;AACA,cAAI8B,MAAJ,EAAY;AACRA,YAAAA,MAAM,CAACE,SAAP,GAAmB,CAACP,OAApB;AACH;AACJ;;AAEaQ,QAAAA,UAAU,CAACC,CAAD,EAAIC,QAAJ,EAAsB;AACtC,cAAIA,QAAQ,KAAK,UAAjB,EAA6B;AACzB,iBAAKlB,YAAL,CAAkBmB,IAAlB;AACH,WAFD,MAEO,IAAID,QAAQ,KAAK,MAAjB,EAAyB;AAC5B,iBAAKT,WAAL,CAAiBW,UAAjB;AACA,iBAAKf,sBAAL;AACH,WAHM,MAGA,IAAIa,QAAQ,KAAK,eAAjB,EAAkC;AACrC,iBAAKG,YAAL,CAAkBF,IAAlB;AACH;AACJ;;AA5D+B,O","sourcesContent":["/**\n * @Descripttion:\n * @version: 1.0\n * @Author: Lioesquieu\n * @Date: 2025-07-20\n * @LastEditors: Lioesquieu\n * @LastEditTime: 2024-08-08\n */\nimport {_decorator, Component, Label, Button, Sprite} from 'cc';\nimport { CwgStateInfo } from './CwgState';\nimport { VwFunland } from './VwFunland';\nimport EventMng from '../common/EventMng';\nimport { VwExchange } from './prop-anims/VwExchange';\nimport { VwAddGlass } from './prop-anims/VwAddGlass';\n\nconst {ccclass, menu, property} = _decorator;\n\n@ccclass('VwUi')\n@menu('cwg/VwUi')\nexport class VwUi extends Component {\n\n    @property(Label)\n    protected levelLabel: Label;\n\n    @property(VwFunland)\n    protected funlandView: VwFunland;\n\n    @property(Button)\n    protected undoButton: Button;\n\n    @property(VwExchange)\n    protected exchangeView: VwExchange;\n\n    @property(VwAddGlass)\n    protected addGlassView: VwAddGlass;\n\n    public reset(info: CwgStateInfo) {\n        this.levelLabel.string = \"第\" + (info.level + 1).toString() + \"关\";\n        EventMng.on('completePour', this.handleCompletePour, this);\n        if (this.exchangeView) {\n            this.exchangeView.node.active = false;\n        }\n    }\n\n    protected onDestroy() {\n        EventMng.offTarget(this);\n    }\n\n    protected handleCompletePour() {\n        this.updateUndoDisplayState();\n    }\n\n    // 在 VwUi.ts 中\nprotected updateUndoDisplayState() {\n    // 首先检查撤销按钮及其节点是否有效\n    if (!this.undoButton || !this.undoButton.node || !this.undoButton.node.isValid) {\n        return;\n    }\n\n    // 检查撤销栈是否存在且不为空\n    const canUndo = this.funlandView.undoStack && this.funlandView.undoStack.length > 0;\n    \n    this.undoButton.interactable = canUndo;\n\n    const sprite = this.undoButton.node.getComponent(Sprite);\n    if (sprite) {\n        sprite.grayscale = !canUndo;\n    }\n}\n\n    protected handleProp(_, propName: string) {\n        if (propName === \"exchange\") {\n            this.exchangeView.show();\n        } else if (propName === \"undo\") {\n            this.funlandView.handleUndo();\n            this.updateUndoDisplayState();\n        } else if (propName === \"addEmptyGlass\") {\n            this.addGlassView.show();\n        }\n    }\n}"]}
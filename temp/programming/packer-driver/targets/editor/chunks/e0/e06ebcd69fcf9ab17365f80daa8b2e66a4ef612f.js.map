{"version":3,"sources":["file:///Users/songxiangying/Library/Containers/com.tencent.xinWeChat/Data/Documents/xwechat_files/wxid_4kr9sthln3gq22_cb54/msg/file/2025-11/cc123/assets/editor/VwEdPlay.ts"],"names":["_decorator","Node","profiler","director","VwEdFunland","CwgState","EdFunlandInfo","UiEdColumn","EdGlass","VwEdUi","VwPlay","ccclass","menu","property","VwEdPlay","type","override","start","hideStats","gameState","funland","init","restartLevel","reset","vwFunland","ui","info","playStart","exportLevelData","glassInfos","columnsNode","children","forEach","node","active","columnController","getComponent","glassesNode","glassNode","glassController","glassData","position","x","y","push","sort","a","b","saveLevelData","openGame","loadScene"],"mappings":"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","sourcesContent":["/**\n * @Descripttion: 编辑模式下的游戏控制器 - 用于关卡编辑和测试\n * @version: 1.0\n * @Author: Lioesquieu\n * @Date: 2025-07-20\n * @LastEditors: Lioesquieu\n * @LastEditTime:2025-07-20\n * \n * 功能说明：\n * - 管理编辑模式下的游戏状态\n * - 提供关卡重置、切换、导出功能\n * - 协调视图层和逻辑层的交互\n */\nimport {_decorator, Component, Node, profiler, director} from 'cc';\nimport {VwEdFunland} from './VwEdFunland';\nimport CwgState from '../core/CwgState';\nimport EdFunlandInfo, {EdGlassInfo} from './EdFunlandInfo';\nimport UiEdColumn from './UiEdColumn';\nimport EdGlass from './EdGlass';\nimport {GlassInfo} from '../core/FunlandInfo';\nimport VwEdUi from './VwEdUi';\nimport { VwPlay } from '../core/VwPlay';\n\nconst {ccclass, menu, property} = _decorator;\n\n/**\n * 编辑模式游戏控制器\n * 负责管理编辑模式下的游戏流程，包括关卡测试、数据导出等\n */\n@ccclass('VwEdPlay')\n@menu('cwg/VwEdPlay')\nexport class VwEdPlay extends VwPlay {\n\n    /** 编辑模式的游乐场视图控制器 */\n    @property({type: VwEdFunland, override: true})\n    protected vwFunland: VwEdFunland;\n\n    /** 编辑模式的UI控制器 */\n    @property({type: VwEdUi, override: true})\n    protected ui: VwEdUi;\n\n    /** 关卡列节点容器 - 包含所有关卡列的父节点 */\n    @property(Node)\n    protected columnsNode: Node;\n\n    /** 游乐场数据管理器 - 管理当前编辑的关卡数据 */\n    public funland: EdFunlandInfo;\n\n    /**\n     * 组件初始化\n     * 隐藏性能统计，初始化游戏状态和关卡数据\n     */\n    start() {\n        profiler.hideStats();\n        this.gameState = new CwgState();\n        this.funland = new EdFunlandInfo();\n        this.funland.init(this.gameState);\n\n        // 开始\n        this.restartLevel();\n    }\n\n    /**\n     * 重新开始当前关卡\n     * 重置游戏状态、关卡数据，并重新初始化视图\n     */\n    protected async restartLevel() {\n        // 重置游戏状态\n        this.gameState.reset();\n        // 重置关卡数据\n        await this.funland.reset();\n        \n        this.vwFunland.reset(this.funland);\n        this.ui.reset(this.gameState.info, this.funland);\n        // 开始游戏\n        this.vwFunland.playStart();\n    }\n\n    /**\n     * 导出当前编辑的关卡数据\n     * 收集所有激活的关卡列和杯子数据，保存为关卡配置\n     */\n    protected exportLevelData() {\n        const glassInfos: EdGlassInfo[] = [];\n        // 遍历所有关卡列节点\n        this.columnsNode.children.forEach((node) => {\n            // 跳过未激活的节点\n            if (!node.active) {\n                return;\n            }\n            const columnController = node.getComponent(UiEdColumn);\n            // 收集该列中的所有杯子数据\n            columnController.glassesNode.children.forEach((glassNode) => {\n                const glassController = glassNode.getComponent(EdGlass);\n                const glassData: GlassInfo = glassController.info;\n                // 记录杯子的位置信息\n                glassData.position = {x: node.x, y: glassNode.y};\n                glassInfos.push(glassData);\n            })\n        })\n        \n        // 对stageInfos进行排序，按y从大到小排，x从小到大排序\n        glassInfos.sort((a, b) => {\n            if (a.position.y != b.position.y) {\n                return b.position.y - a.position.y;\n            }\n            return a.position.x - b.position.x;\n        })\n\n        // 保存关卡数据到文件\n        this.ui.saveLevelData(glassInfos);\n    }\n\n    protected openGame() {\n        director.loadScene('game');\n    }\n}"]}
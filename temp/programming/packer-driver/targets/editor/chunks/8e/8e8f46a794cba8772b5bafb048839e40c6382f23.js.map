{"version":3,"sources":["file:///Users/songxiangying/Desktop/cc1234223/assets/editor/VwEdFunland.ts"],"names":["_decorator","Component","Node","CwgPools","UiEdColumn","VwEdGlassSetting","EdGlass","UiEdColorCount","UiEdColumnCount","ccclass","menu","property","VwEdFunland","onLoad","console","log","reset","funland","uiColumnCount","registerTouchEvents","contentNode","targetOff","on","EventType","TOUCH_END","touch","currentSelected","handleTouchEnd","getUILocation","showGlassConfigMenu","glass","glassMenu","node","active","init","onClose","info","uiColorCount","updateColorConfiguration","location","selectedGlass","children","find","index","column","getComponent","glassesNode","getTouchBoundingBoxToWorld","contains","pickupGlass","pickup","playStart"],"mappings":"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","sourcesContent":["/**\n * @Descripttion:游乐场编辑器视图\n * @classdesc 负责游乐场布局编辑的视图组件\n * @version: 1.0\n * @Author: Lioesquieu\n * @Date: 2025-07-20\n * @LastEditors: Lioesquieu\n * @LastEditTime: 2025-07-22\n */\nimport {_decorator, Component, EventTouch, Node, Vec2} from 'cc';\nimport {CwgPools} from '../core/CwgPools';\nimport UiEdColumn from './UiEdColumn';\nimport VwEdGlassSetting from './VwEdGlassSetting';\nimport EdFunlandInfo, {EdGlassInfo} from './EdFunlandInfo';\nimport EdGlass from './EdGlass';\nimport UiEdColorCount from './UiEdColorCount';\nimport UiEdColumnCount from './UiEdColumnCount';\n\nconst {ccclass, menu, property} = _decorator;\n\n@ccclass('VwEdFunland')\n@menu('cwg/VwEdFunland')\nexport class VwEdFunland extends Component {\n\n    /** 玻璃瓶容器节点 */\n    @property(Node)\n    protected contentNode: Node;\n\n    /** 特效展示节点 */\n    @property(Node)\n    protected effectNode: Node;\n\n    /** 对象池管理器 */\n    @property(CwgPools)\n    protected pools: CwgPools;\n\n    /** 玻璃瓶配置菜单 */\n    @property(VwEdGlassSetting)\n    protected glassMenu: VwEdGlassSetting;\n\n    /** 列数配置UI组件 */\n    @property(UiEdColumnCount)\n    protected uiColumnCount: UiEdColumnCount;\n\n    /** 颜色数量配置UI组件 */\n    @property(UiEdColorCount)\n    protected uiColorCount: UiEdColorCount;\n\n    protected funland: EdFunlandInfo;\n\n    protected onLoad() {\n        console.log(\"StVwFunland\")\n    }\n\n    /**\n     * 初始化游乐场布局\n     * @param funland 游乐场配置数据\n     */\n    public reset(funland: EdFunlandInfo) {\n        this.funland = funland;\n        this.uiColumnCount.reset(funland);\n    }\n\n    // 触摸事件处理\n    protected registerTouchEvents() {\n        this.contentNode.targetOff(this);\n\n        // 注册触摸结束事件\n        this.contentNode.on(Node.EventType.TOUCH_END, (touch: EventTouch) => {\n\n            // 判断哪个瓶子被点击到了\n            // 查找被点击的玻璃瓶\n            const currentSelected = this.handleTouchEnd(touch.getUILocation());\n            if (currentSelected) {\n                this.showGlassConfigMenu(currentSelected);\n            }\n\n        }, this);\n    }\n\n    protected showGlassConfigMenu(glass: EdGlass) {\n        console.log('showMenu')\n        this.glassMenu.node.active = true;\n        this.glassMenu.init(glass);\n        this.glassMenu.onClose = (info: EdGlassInfo) => {\n            console.log('onClose', info);\n\n            this.uiColorCount.updateColorConfiguration();\n        }\n    }\n\n    /**\n     * 处理触摸结束事件\n     * @param location 触摸点的UI坐标\n     * @returns 被选中的玻璃瓶实例\n     */\n    private handleTouchEnd(location: Vec2) {\n        let selectedGlass: EdGlass;\n        // 遍历所有列查找被点击的玻璃瓶\n        this.contentNode.children.find((node, index) => {\n            const column = node.getComponent(UiEdColumn);\n            // 在列中查找具体玻璃瓶\n            return column.glassesNode.children.find((node) => {\n                const glass = node.getComponent(EdGlass);\n                if (glass.getTouchBoundingBoxToWorld().contains(location)) {\n                    selectedGlass = glass;\n                    return glass;\n                }\n            })\n        });\n        return selectedGlass;\n    }\n\n    protected pickupGlass(glass: EdGlass) {\n        glass.pickup();\n    }\n\n    /** 开始游戏交互 */\n    public playStart() {\n        this.registerTouchEvents();\n    }\n}"]}
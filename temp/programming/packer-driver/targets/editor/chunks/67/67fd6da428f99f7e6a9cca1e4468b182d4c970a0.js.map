{"version":3,"sources":["file:///Users/songxiangying/Library/Containers/com.tencent.xinWeChat/Data/Documents/xwechat_files/wxid_4kr9sthln3gq22_cb54/msg/file/2025-11/cc123/assets/core/prop-anims/VwAddGlass.ts"],"names":["_decorator","Component","instantiate","Node","v3","Prefab","VwFunland","ccclass","menu","property","VwAddGlass","show","glassMap","Map","funlandView","funland","glasses","forEach","glass","column","get","position","x","set","push","addGlassInfo","undefined","key","columns","length","y","colors","hideCnt","ad","lastGlass","hide","node","worldPosition","active","scheduleOnce","dmNode","parent","contentNode","addEmptyGlass","removeAllChildren"],"mappings":"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","sourcesContent":["/**\n * @Descripttion:\n * 使用交换道具：先显示一层选择特效，提示用户选择一个瓶子。选择瓶子后，完成选中瓶子内水层的随机交换\n * @version: 1.0\n * @Author: Lioesquieu\n * @Date: 2025-08-07\n * @LastEditors: Lioesquieu\n * @LastEditTime: 2025-08-07\n */\nimport {_decorator, Component, instantiate, EventTouch, Node, v3, Vec2, Prefab, UITransform} from 'cc';\nimport { VwFunland } from '../VwFunland';\nimport { GlassInfo } from '../FunlandInfo';\n\nconst {ccclass, menu, property} = _decorator;\n\n@ccclass('VwAddGlass')\n@menu('cwg/VwAddGlass')\nexport class VwAddGlass extends Component {\n\n    @property(Node)\n    protected contentNode: Node;\n\n    @property(Prefab)\n    protected dmNode: Prefab;\n\n    @property(VwFunland)\n    protected funlandView: VwFunland;\n\n    public show() {\n        // 把this.funland.glasses按列分组\n        const glassMap: Map<number, GlassInfo[]> = new Map();\n        this.funlandView.funland.glasses.forEach((glass) => {\n            let column =  glassMap.get(glass.position.x);\n            if (!column) {\n                column = [];\n                glassMap.set(glass.position.x, column);\n            }\n            column.push(glass);\n        });\n\n        let addGlassInfo = undefined;\n        for (const [key, columns] of glassMap) {\n            if (columns.length >= 4) {\n                continue;\n            }\n            // 如果这一列的上面可以放\n            if (columns[0].position.y <= 40) {\n                addGlassInfo = {\n                    position: { x: columns[0].position.x, y: columns[0].position.y + 260 },\n                    colors: [],\n                    hideCnt: 0,\n                    ad: false,\n                }\n                break;\n            }\n            // 如果这一列的下面可以放\n            const lastGlass = columns[columns.length - 1];\n            if (lastGlass.position.y >= -220) {\n                addGlassInfo = {\n                    position: { x: lastGlass.position.x, y: lastGlass.position.y - 260 },\n                    colors: [],\n                    hideCnt: 0,\n                    ad: false,\n                }\n                break;\n            }\n        }\n        if (!addGlassInfo) {\n            this.hide();\n            return;\n        }\n        this.node.worldPosition = this.funlandView.node.worldPosition;\n        this.node.active = true;\n\n        this.scheduleOnce(() => {\n            const node = instantiate(this.dmNode);\n            node.active = true;\n            node.parent = this.contentNode;\n            node.position = v3(addGlassInfo.position.x, addGlassInfo.position.y, 0);\n\n            this.funlandView.addEmptyGlass(addGlassInfo);\n        }, 0.3);\n\n        this.scheduleOnce(() => {\n            this.hide();\n        }, 1);\n    }\n\n    public hide() {\n        this.contentNode.removeAllChildren();\n        this.node.active = false;\n    }\n}"]}
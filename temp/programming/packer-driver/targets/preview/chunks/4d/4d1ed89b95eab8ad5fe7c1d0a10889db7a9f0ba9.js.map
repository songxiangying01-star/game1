{"version":3,"sources":["file:///Users/songxiangying/Desktop/cc1234223/assets/editor/UiEdColumnCount.ts"],"names":["_decorator","Component","Label","Node","UiEdColumnCtrl","ccclass","menu","property","UiEdColumnCount","count","columnMap","Map","reset","funland","glasses","forEach","item","key","position","x","items","get","push","set","size","currentStageConfig","undefined","updateCountDisplay","increaseColumnCount","decreaseColumnCount","countLabel","string","toString","width","sortedEntries","Array","from","entries","sort","a","b","maxCnt","length","columnCtrlsContent","children","index","colument","getComponent","uiTransform","active"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWQA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;;AAC/BC,MAAAA,c;;;;;;AAZP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;OAMM;AAACC,QAAAA,OAAD;AAAUC,QAAAA,IAAV;AAAgBC,QAAAA;AAAhB,O,GAA4BP,U;;yBAIbQ,e,WAFpBH,OAAO,CAAC,iBAAD,C,UACPC,IAAI,CAAC,qBAAD,C,UAIAC,QAAQ,CAACJ,IAAD,C,UAIRI,QAAQ,CAACL,KAAD,C,0CATb,MAEqBM,eAFrB,SAE6CP,SAF7C,CAEuD;AAAA;AAAA;;AAEnD;AAFmD;;AAMnD;AANmD;;AAAA,eAU5CQ,KAV4C,GAU5B,CAV4B;AAAA,eAWzCC,SAXyC,GAWH,IAAIC,GAAJ,EAXG;AAAA;;AAYnD;;AAGA;AACJ;AACA;AACA;AACIC,QAAAA,KAAK,CAACC,OAAD,EAA0B;AAC3B,cAAIA,OAAJ,EAAa;AACT,gBAAMH,SAAmC,GAAG,IAAIC,GAAJ,EAA5C;AACAE,YAAAA,OAAO,CAACC,OAAR,CAAgBC,OAAhB,CAAyBC,IAAD,IAAU;AAC9B,kBAAMC,GAAG,GAAGD,IAAI,CAACE,QAAL,CAAcC,CAA1B;AACA,kBAAMC,KAAkB,GAAGV,SAAS,CAACW,GAAV,CAAcJ,GAAd,KAAsB,EAAjD;AACAG,cAAAA,KAAK,CAACE,IAAN,CAAWN,IAAX;AACAN,cAAAA,SAAS,CAACa,GAAV,CAAcN,GAAd,EAAmBG,KAAnB;AACH,aALD;AAMA,iBAAKV,SAAL,GAAiBA,SAAjB;AACA,iBAAKD,KAAL,GAAa,KAAKC,SAAL,CAAec,IAA5B;AACA,iBAAKC,kBAAL,GAA0BZ,OAA1B;AACH,WAXD,MAWO;AACH,iBAAKJ,KAAL,GAAa,CAAb;AACA,iBAAKgB,kBAAL,GAA0BC,SAA1B;AACH;;AACD,eAAKC,kBAAL;AACH;AAED;;;AACUC,QAAAA,mBAAmB,GAAG;AAC5B,cAAI,KAAKnB,KAAL,IAAc,CAAlB,EAAqB;AACjB;AACH;;AACD,eAAKA,KAAL;AACA,eAAKkB,kBAAL;AACH;AAED;;;AACUE,QAAAA,mBAAmB,GAAG;AAC5B,cAAI,KAAKpB,KAAL,IAAc,CAAlB,EAAqB;AACjB;AACH;;AACD,eAAKA,KAAL;AACA,eAAKkB,kBAAL;AACH;AAED;;;AACUA,QAAAA,kBAAkB,GAAG;AAC3B,eAAKG,UAAL,CAAgBC,MAAhB,GAAyB,KAAKtB,KAAL,CAAWuB,QAAX,EAAzB,CAD2B,CAE3B;;AACA,cAAMC,KAAK,GAAG,MAAM,KAAKxB,KAAzB;AAEA,cAAMyB,aAAa,GAAGC,KAAK,CAACC,IAAN,CAAW,KAAK1B,SAAL,CAAe2B,OAAf,EAAX,EAAqCC,IAArC,CAA0C,CAACC,CAAD,EAAIC,CAAJ,KAAUD,CAAC,CAAC,CAAD,CAAD,GAAOC,CAAC,CAAC,CAAD,CAA5D,CAAtB;AACA,cAAMC,MAAM,GAAGP,aAAa,CAACQ,MAA7B;AACA,eAAKC,kBAAL,CAAwBC,QAAxB,CAAiC7B,OAAjC,CAAyC,CAACC,IAAD,EAAO6B,KAAP,KAAiB;AACtD,gBAAMC,QAAQ,GAAG9B,IAAI,CAAC+B,YAAL;AAAA;AAAA,iDAAjB;;AACA,gBAAIF,KAAK,GAAGJ,MAAZ,EAAoB;AAChBK,cAAAA,QAAQ,CAAClC,KAAT,CAAesB,aAAa,CAACW,KAAD,CAAb,CAAqB,CAArB,CAAf;AACH,aAFD,MAEO;AACHC,cAAAA,QAAQ,CAAClC,KAAT,CAAe,EAAf;AACH;;AACDkC,YAAAA,QAAQ,CAACE,WAAT,CAAqBf,KAArB,GAA6BA,KAA7B;AACAjB,YAAAA,IAAI,CAACiC,MAAL,GAAcJ,KAAK,GAAG,KAAKpC,KAA3B;AACH,WATD;AAUH;;AA1EkD,O","sourcesContent":["/**\n * @Descripttion: 控制列数\n * 1. 管理关卡编辑器的列数显示\n * 2. 同步列数与关卡数据的映射关系\n * 3. 控制列数增减操作\n * @version: 1.0\n * @Author: Lioesquieu\n * @Date: 2025-07-20\n * @LastEditors: Lioesquieu\n * @LastEditTime: 2024-08-08\n */\nimport {_decorator, Component, Label, Node} from 'cc';\nimport UiEdColumnCtrl from './UiEdColumnCtrl';\nimport EdFunlandInfo from './EdFunlandInfo';\nimport {GlassInfo} from '../core/FunlandInfo';\n\nconst {ccclass, menu, property} = _decorator;\n\n@ccclass('UiEdColumnCount')\n@menu('cwg/UiEdColumnCount')\nexport default class UiEdColumnCount extends Component {\n\n    /** 列控制器容器节点 */\n    @property(Node)\n    public columnCtrlsContent: Node;\n\n    /** 当前列数显示标签 */\n    @property(Label)\n    protected countLabel: Label;\n\n    public count: number = 5;\n    protected columnMap: Map<number, GlassInfo[]> = new Map();\n    /** 当前配置的关卡数据 */\n    protected currentStageConfig: EdFunlandInfo;\n\n    /**\n     * 重置控制器状态\n     * @param funland 关卡数据（为空时重置为默认状态）\n     */\n    reset(funland?: EdFunlandInfo) {\n        if (funland) {\n            const columnMap: Map<number, GlassInfo[]> = new Map();\n            funland.glasses.forEach((item) => {\n                const key = item.position.x;\n                const items: GlassInfo[] = columnMap.get(key) || [];\n                items.push(item);\n                columnMap.set(key, items);\n            })\n            this.columnMap = columnMap;\n            this.count = this.columnMap.size;\n            this.currentStageConfig = funland;\n        } else {\n            this.count = 5;\n            this.currentStageConfig = undefined;\n        }\n        this.updateCountDisplay();\n    }\n\n    /** 增加列数（最大不超过8列） */\n    protected increaseColumnCount() {\n        if (this.count >= 8) {\n            return;\n        }\n        this.count++;\n        this.updateCountDisplay();\n    }\n\n    /** 减少列数（最小不低于0列） */\n    protected decreaseColumnCount() {\n        if (this.count <= 0) {\n            return;\n        }\n        this.count--;\n        this.updateCountDisplay();\n    }\n\n    /** 更新列数显示和控制器布局 */\n    protected updateCountDisplay() {\n        this.countLabel.string = this.count.toString();\n        // 总宽度744px根据列数均分（假设为固定容器宽度）\n        const width = 744 / this.count;\n\n        const sortedEntries = Array.from(this.columnMap.entries()).sort((a, b) => a[0] - b[0]);\n        const maxCnt = sortedEntries.length;\n        this.columnCtrlsContent.children.forEach((item, index) => {\n            const colument = item.getComponent(UiEdColumnCtrl);\n            if (index < maxCnt) {\n                colument.reset(sortedEntries[index][1]);\n            } else {\n                colument.reset([]);\n            }\n            colument.uiTransform.width = width;\n            item.active = index < this.count;\n        })\n    }\n}"]}
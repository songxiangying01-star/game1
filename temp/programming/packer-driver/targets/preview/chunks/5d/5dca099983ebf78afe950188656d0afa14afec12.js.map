{"version":3,"sources":["file:///Users/songxiangying/Library/Containers/com.tencent.xinWeChat/Data/Documents/xwechat_files/wxid_4kr9sthln3gq22_cb54/msg/file/2025-11/cc123/assets/core/CwgPools.ts"],"names":["_decorator","Component","Node","Tween","Pool","Glass","GlassPourOut","GlassFlowing","Toolkit","EfParticleSystem2D","ccclass","menu","property","CwgPools","onLoad","glassPool","create","glassNode","pourOutAnimPool","pourOutAnimNode","flowingAnimPool","flowingAnimNode","fullSealedAnimPool","efFullSealedNode","getGlass","node","get","getComponent","recycleGlass","glass","isValid","stopAllByTarget","put","getPourOutAnim","parentNode","parent","worldPosition","clone","glassAnim","init","cloneObj","info","recyclePourOutAnim","anim","getFlowingAnim","sourceGlass","setSiblingIndex","getSiblingIndex","recycleFlowingAnim","getFullSealedEffect","pos","active","setPosition","effect","recycleFullSealedEffect","onDestroy","destroy","undefined"],"mappings":"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","sourcesContent":["/**\n * @Descripttion:\n * @version: 1.0\n * @Author: Lioesquieu\n * @Date: 2025-07-20\n * @LastEditors: Lioesquieu\n * @LastEditTime: 2025-07-22\n */\nimport {_decorator, Component, Node, Tween, Vec3} from 'cc';\nimport Pool from \"../common/Pool\";\nimport Glass from \"./Glass\";\nimport GlassPourOut from \"./glass-anims/GlassPourOut\";\nimport GlassFlowing from \"./glass-anims/GlassFlowing\";\nimport Toolkit from \"../common/Toolkit\";\nimport {WaterColor} from \"./CwgConstant\";\nimport { GlassInfo } from './FunlandInfo';\nimport { EfParticleSystem2D } from './other-anims/EfParticleSystem2D';\n\nconst {ccclass, menu, property} = _decorator;\n\n@ccclass('CwgPools')\n@menu('cwg/CwgPools')\nexport class CwgPools extends Component {\n\n    @property(Node)\n    protected glassNode: Node;\n\n    @property(Node)\n    protected pourOutAnimNode: Node;\n\n    @property(Node)\n    protected flowingAnimNode: Node;\n\n    @property(Node)\n    protected efFullSealedNode: Node;   // 满瓶密封效果节点\n\n    protected glassPool: Pool;\n\n    protected pourOutAnimPool: Pool;\n\n    protected flowingAnimPool: Pool;\n\n    protected fullSealedAnimPool: Pool;\n\n    /**\n     * @description 对象池初始化（Cocos Creator生命周期函数）\n     */\n    onLoad() {\n        this.glassPool = Pool.create(this.glassNode);\n        this.pourOutAnimPool = Pool.create(this.pourOutAnimNode);\n        this.flowingAnimPool = Pool.create(this.flowingAnimNode);\n        this.fullSealedAnimPool = Pool.create(this.efFullSealedNode);\n    }\n\n    /**\n     * @description 从对象池获取玻璃杯实例\n     * @returns 玻璃杯组件实例\n     */\n    public getGlass(): Glass {\n        const node = this.glassPool.get();\n        return node.getComponent(Glass);\n    }\n\n    /**\n     * @description 回收玻璃杯到对象池\n     * @param glass 需要回收的玻璃杯组件\n     */\n    public recycleGlass(glass: Glass) {\n        if (!glass?.node?.isValid) return;\n        Tween.stopAllByTarget(glass.node);\n        this.glassPool.put(glass.node);\n    }\n\n    public getPourOutAnim(glass: Glass, parentNode: Node) {\n        const node = this.pourOutAnimPool.get();\n        node.parent = parentNode;\n        node.worldPosition = glass.node.worldPosition.clone();\n        const glassAnim = node.getComponent(GlassPourOut);\n        glassAnim.init(Toolkit.cloneObj(glass.info) as GlassInfo);\n        return glassAnim;\n    }\n\n    public recyclePourOutAnim(anim: GlassPourOut) {\n        if (!anim?.node?.isValid) return;\n        Tween.stopAllByTarget(anim.node);\n        this.pourOutAnimPool.put(anim.node);\n    }\n\n    /**\n     * @description 获取水流动画实例\n     * @param sourceGlass 来源玻璃杯组件\n     * @param parentNode 父级节点\n     * @returns 初始化后的水流动画组件\n     */\n    public getFlowingAnim(sourceGlass: Glass, parentNode: Node) {\n        const node = this.flowingAnimPool.get();\n        node.parent = parentNode;\n        node.worldPosition = sourceGlass.node.worldPosition.clone();\n        node.setSiblingIndex(sourceGlass.node.getSiblingIndex());\n        const glassAnim = node.getComponent(GlassFlowing);\n        glassAnim.init(Toolkit.cloneObj(sourceGlass.info) as GlassInfo);\n        return glassAnim;\n    }\n\n    public recycleFlowingAnim(anim: GlassFlowing) {\n        if (!anim?.node?.isValid) return;\n        Tween.stopAllByTarget(anim.node);\n        this.flowingAnimPool.put(anim.node);\n    } \n\n    public getFullSealedEffect(pos?: Vec3, parentNode?: Node) {\n        const node = this.fullSealedAnimPool.get();\n        node.active = true;\n        pos && node.setPosition(pos);\n        parentNode && (node.parent = parentNode);\n\n        const effect = node.getComponent(EfParticleSystem2D);\n        return effect;\n    }\n\n    public recycleFullSealedEffect(node: Node) {\n        if (!node?.isValid) return;\n        this.fullSealedAnimPool.put(node);\n    }\n\n    onDestroy() {\n        if (this.glassPool) {\n            this.glassPool.destroy();\n            this.glassPool = undefined;\n        }\n    }\n}"]}
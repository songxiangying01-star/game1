{"version":3,"sources":["file:///Users/songxiangying/Library/Containers/com.tencent.xinWeChat/Data/Documents/xwechat_files/wxid_4kr9sthln3gq22_cb54/msg/file/2025-11/cc123/assets/editor/UiEdColorCount.ts"],"names":["_decorator","Component","Label","Node","UiEdColumn","Rand","WaterColor","EdGlass","ccclass","menu","property","UiEdColorCount","count","start","updateColorConfiguration","handleIncrement","handleDecrement","calculateTotalWaterSegments","total","columnsContent","children","forEach","node","active","item","getComponent","glassesNode","glass","info","colorCnt","undefined","totalSegments","Math","floor","cntLabel","string","toString","colors","color","None","i","push","Black","waterSegments","shift","sort","len","length","ad","splice","init","choseReset"],"mappings":"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","sourcesContent":["/**\n * @Descripttion: 控制颜色数量\n * @version: 1.0\n * @Author: Lioesquieu\n * @Date: 2025-07-20\n * @LastEditors: Lioesquieu\n * @LastEditTime: 2024-08-08\n */\nimport {_decorator, Component, Label, Node} from 'cc';\nimport UiEdColumn from './UiEdColumn';\nimport Rand from '../common/Rand';\nimport {WaterColor} from '../core/CwgConstant';\nimport EdGlass from './EdGlass';\n\nconst {ccclass, menu, property} = _decorator;\n\n@ccclass('UiEdColorCount')\n@menu('cwg/UiEdColorCount')\nexport default class UiEdColorCount extends Component {\n\n    @property(Node)\n    public columnsContent: Node;\n\n    @property(Label)\n    protected cntLabel: Label;\n\n    public count: number = 5;\n\n    protected start(): void {\n        this.updateColorConfiguration();\n    }\n\n    protected handleIncrement() {\n        if (this.count >= 8) {\n            return;\n        }\n        this.count++;\n        this.updateColorConfiguration();\n    }\n\n    protected handleDecrement() {\n        if (this.count <= 0) {\n            return;\n        }\n        this.count--;\n        this.updateColorConfiguration();\n    }\n\n    /**\n     * 计算当前场景中所有水柱的总段数\n     * 每瓶水最多可分割为4段（对应4种颜色）\n     */\n    protected calculateTotalWaterSegments() {\n        let total = 0;  // 瓶子总数\n        this.columnsContent.children.forEach((node) => {\n            if (!node.active) {\n                return;\n            }\n            const item: UiEdColumn = node.getComponent(UiEdColumn);\n            item.glassesNode.children.forEach((node) => {\n                const glass = node.getComponent(EdGlass);\n                if (glass.info.colorCnt == undefined) {\n                    total += 4;\n                } else {\n                    total += glass.info.colorCnt;\n                }\n            })\n        })\n        return total;\n    }\n\n    /**\n     * 更新颜色配置\n     * 1. 根据总水柱段数计算最大可用颜色数\n     * 2. 生成随机颜色序列\n     * 3. 分配颜色到各个玻璃瓶\n     */\n    public updateColorConfiguration() {\n        // 计算最大可用颜色数（每4段水柱对应1种颜色）\n        const totalSegments = Math.floor(this.calculateTotalWaterSegments() / 4);\n        if (this.count > totalSegments) {\n            this.count = totalSegments;\n        }\n        if (this.count == 0) {\n            this.count = 1;\n        }\n        this.cntLabel.string = this.count.toString();\n\n        // 生成基础颜色序列（确保颜色不重复循环）\n        let colors: WaterColor[] = [];\n        let color = WaterColor.None + 1;\n        for (let i = 0; i < this.count; i++) {\n            colors.push(color)\n            color++;\n            if (color >= WaterColor.Black) {\n                color = WaterColor.None + 1;\n            }\n        }\n\n        // 分配颜色到水柱（每颜色重复4次形成完整水柱）\n        const waterSegments: WaterColor[] = [];\n        for (let i = 0; i < totalSegments; i++) {\n            const color = colors.shift();\n            waterSegments.push(color);\n            waterSegments.push(color);\n            waterSegments.push(color);\n            waterSegments.push(color);\n            colors.push(color);\n        }\n\n        // 随机打乱颜色顺序实现自然分布\n        Rand.sort(waterSegments);\n\n        this.columnsContent.children.forEach((node) => {\n            if (!node.active) {\n                return;\n            }\n            const item: UiEdColumn = node.getComponent(UiEdColumn);\n            for (let i = 0, len = item.glassesNode.children.length; i < len; i++) {\n                const node = item.glassesNode.children[i];\n                const glass = node.getComponent(EdGlass);\n                if (glass.info.ad) {\n                    glass.info.colorCnt = 0;\n                    glass.info.colors = [];\n                } else {\n                    if (glass.info.colorCnt == undefined) {\n                        glass.info.colorCnt = 4;\n                    }\n                    if (waterSegments.length < glass.info.colorCnt) {\n                        glass.info.colors = waterSegments.splice(0, waterSegments.length);\n                    } else {\n                        glass.info.colors = waterSegments.splice(0, glass.info.colorCnt);\n                    }\n                }\n                glass.init(glass.info);\n            }\n        })\n    }\n\n    protected choseReset() {\n        this.updateColorConfiguration();\n    }\n}"]}
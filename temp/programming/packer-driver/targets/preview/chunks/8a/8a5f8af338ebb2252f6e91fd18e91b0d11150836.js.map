{"version":3,"sources":["file:///Users/songxiangying/Desktop/cc1234223/assets/core/glass-anims/WaterSurface.ts"],"names":["_decorator","Component","Node","Sprite","ccclass","menu","property","WaterSurface","tooltip","type","waterMaterial","_waveTime","_waveAmplitude","tweenProperty","reset","undefined","surfaceSprite","getSurfaceSprite","node","active","getMaterialInstance","surfaceEffect","surfaceNode","getSurfaceNode","children","getComponent","i","waterNode","watersNode","update","dt","setProperty"],"mappings":";;;;;;;;;;;;;;;;AAQQA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAqBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;;;;;;AAR/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;OAGM;AAACC,QAAAA,OAAD;AAAUC,QAAAA,IAAV;AAAgBC,QAAAA;AAAhB,O,GAA4BN,U;;yBAKbO,Y,WAFpBH,OAAO,CAAC,cAAD,C,UACPC,IAAI,CAAC,kBAAD,C,UAGAC,QAAQ,CAAC;AAACE,QAAAA,OAAO,EAAE;AAAV,OAAD,C,UAGRF,QAAQ,CAAC;AAACG,QAAAA,IAAI,EAAEP,IAAP;AAAaM,QAAAA,OAAO,EAAE;AAAtB,OAAD,C,0CAPb,MAEqBD,YAFrB,SAE0CN,SAF1C,CAEoD;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAQxCS,aARwC,GAQd,IARc;AAAA,eASxCC,SATwC,GAS5B,CAT4B;AAAA,eAUxCC,cAVwC,GAUvB,CAVuB;AAYhD;AAZgD,eAatCC,aAbsC,GAaV,IAbU;AAAA;;AAehD;AACJ;AACA;AACA;AACWC,QAAAA,KAAK,GAAG;AACX,eAAKJ,aAAL,GAAqBK,SAArB;AACA,cAAMC,aAAa,GAAG,KAAKC,gBAAL,EAAtB;;AACA,cAAI,CAACD,aAAL,EAAoB;AAChB;AACH;;AACD,cAAI,CAACA,aAAa,CAACE,IAAd,CAAmBC,MAAxB,EAAgC;AAC5BH,YAAAA,aAAa,CAACE,IAAd,CAAmBC,MAAnB,GAA4B,IAA5B;AACH;;AACD,eAAKT,aAAL,GAAqBM,aAAa,CAACI,mBAAd,CAAkC,CAAlC,CAArB,CATW,CAWX;;AACA,cAAI,KAAKV,aAAT,EAAwB;AACpB,iBAAKW,aAAL,GAAqB,KAArB;AACH;AACJ;AAED;AACJ;AACA;AACA;;;AACcJ,QAAAA,gBAAgB,GAAG;AACzB,cAAMK,WAAW,GAAG,KAAKC,cAAL,EAApB;;AACA,cAAID,WAAJ,EAAiB;AACb,mBAAOA,WAAW,CAACE,QAAZ,CAAqB,CAArB,EAAwBC,YAAxB,CAAqCtB,MAArC,CAAP;AACH;AACJ;AAED;AACJ;AACA;AACA;;;AACcoB,QAAAA,cAAc,GAAG;AACvB,eAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAI,CAArB,EAAwBA,CAAC,EAAzB,EAA6B;AACzB,gBAAMC,SAAS,GAAG,KAAKC,UAAL,CAAgBJ,QAAhB,CAAyBE,CAAzB,CAAlB;;AACA,gBAAIC,SAAS,CAACR,MAAd,EAAsB;AAClB,qBAAOQ,SAAP;AACH;AACJ;AACJ;;AAESE,QAAAA,MAAM,CAACC,EAAD,EAAa;AACzB,cAAI,CAAC,KAAKT,aAAV,EAAyB;;AACzB,cAAI,CAAC,KAAKX,aAAN,IAAuB,KAAKa,cAAL,EAA3B,EAAkD;AAC9C,iBAAKZ,SAAL,GAAiB,CAAjB;AACA,iBAAKG,KAAL;AACH;;AACD,cAAI,CAAC,KAAKJ,aAAV,EAAyB;AAEzB;;AACA,eAAKC,SAAL,IAAkBmB,EAAlB;AAEA;;AACA,eAAKlB,cAAL,IAAuBkB,EAAvB;;AACA,cAAI,KAAKlB,cAAL,GAAsB,CAA1B,EAA6B;AACzB,iBAAKA,cAAL,GAAsB,CAAtB;AACA,iBAAKS,aAAL,GAAqB,KAArB;AACH;AAED;;;AACA,eAAKX,aAAL,CAAmBqB,WAAnB,CAA+B,MAA/B,EAAuC,KAAKpB,SAA5C;AACA,eAAKD,aAAL,CAAmBqB,WAAnB,CAA+B,eAA/B,EAAgD,KAAKnB,cAArD;AACH;;AAjF+C,O;;;;;iBAGb,K","sourcesContent":["/**\n * @Descripttion:\n * @version: 1.0\n * @Author: Lioesquieu\n * @Date: 2025-07-20\n * @LastEditors: Lioesquieu\n * @LastEditTime: 2025-07-22\n */\nimport {_decorator, Component, Material, Node, Sprite, Tween} from 'cc';\n\nconst {ccclass, menu, property} = _decorator;\n\n\n@ccclass('WaterSurface')\n@menu('cwg/WaterSurface')\nexport default class WaterSurface extends Component {\n\n    @property({tooltip: '是否开启水面波动效果'})\n    protected surfaceEffect: boolean = false;\n\n    @property({type: Node, tooltip: '包含不同水位节点的容器（0-3级水位）'})\n    protected watersNode: Node;\n\n    private waterMaterial: Material = null;\n    private _waveTime = 0;\n    private _waveAmplitude = 5;\n\n    // 【修复点】Tween 需要指定泛型类型，这里改为 Tween<any>\n    protected tweenProperty: Tween<any> = null;\n\n    /**\n     * 重置水面特效参数\n     * 初始化水面材质并设置默认波动参数\n     */\n    public reset() {\n        this.waterMaterial = undefined;\n        const surfaceSprite = this.getSurfaceSprite();\n        if (!surfaceSprite) {\n            return;\n        }\n        if (!surfaceSprite.node.active) {\n            surfaceSprite.node.active = true;\n        }\n        this.waterMaterial = surfaceSprite.getMaterialInstance(0);\n        \n        // 强制关闭波动效果\n        if (this.waterMaterial) {\n            this.surfaceEffect = false;\n        }\n    }\n\n    /**\n     * 获取当前激活水面的精灵组件\n     * @returns 水面精灵对象，未找到时返回null\n     */\n    protected getSurfaceSprite() {\n        const surfaceNode = this.getSurfaceNode();\n        if (surfaceNode) {\n            return surfaceNode.children[0].getComponent(Sprite);\n        }\n    }\n\n    /**\n     * 遍历水位容器查找当前激活的水位节点\n     * @returns 当前激活的最高级别水位节点\n     */\n    protected getSurfaceNode() {\n        for (let i = 3; i >= 0; i--) {\n            const waterNode = this.watersNode.children[i];\n            if (waterNode.active) {\n                return waterNode;\n            }\n        }\n    }\n\n    protected update(dt: number) {\n        if (!this.surfaceEffect) return;\n        if (!this.waterMaterial && this.getSurfaceNode()) {\n            this._waveTime = 0;\n            this.reset();\n        }\n        if (!this.waterMaterial) return;\n\n        /** 累计波动时间（用于材质动画） */\n        this._waveTime += dt;\n\n        /** 当前波动幅度随时间衰减 */\n        this._waveAmplitude -= dt;\n        if (this._waveAmplitude < 0) {\n            this._waveAmplitude = 0;\n            this.surfaceEffect = false;\n        }\n\n        /** 更新材质参数 */\n        this.waterMaterial.setProperty('time', this._waveTime);\n        this.waterMaterial.setProperty('waveAmplitude', this._waveAmplitude);\n    }\n\n}"]}
{"version":3,"sources":["file:///Users/songxiangying/Library/Containers/com.tencent.xinWeChat/Data/Documents/xwechat_files/wxid_4kr9sthln3gq22_cb54/msg/file/2025-11/cc123/assets/core/FunlandInfo.ts"],"names":["FunlandInfo","init","state","reset","data","getData","catch","resetLvData","console","warn","defaultLevel","level","position","x","y","colors","hideCnt","ad","preLevel","info","save","nextLevel","glasses","sort","a","b","debug"],"mappings":"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","sourcesContent":["/**\n * @Descripttion:\n * @version: 1.1 (With Default Level)\n * @Author: Lioesquieu\n * @Date: 2025-07-20\n * @LastEditors: Lioesquieu\n * @LastEditTime: 2025-07-20\n */\nimport CwgState from \"./CwgState\";\n\nexport type GlassInfo = {\n    position: { x: number; y: number };\n    colors: number[],\n    hideCnt: number,       // 隐藏的个数\n    ad: boolean,            // 是否广告\n}\n\nexport type LevelStruct = {\n    level: GlassInfo[]\n}\n\nexport default class FunlandInfo {\n\n    public static debug: boolean = false;\n\n    public glasses: GlassInfo[];\n\n    public state: CwgState;\n\n    public init(state: CwgState) {\n        this.state = state;\n    }\n\n    public async reset() {\n        // 尝试加载 JSON 文件\n        const data = await this.state.getData().catch(() => {\n            return null;\n        });\n\n        if (data) {\n            // 如果加载成功，使用 JSON 数据\n            this.resetLvData(data as LevelStruct);\n        } else {\n            // 【关键修改】如果加载失败（data为null），使用默认的保底数据\n            console.warn(\"关卡数据加载失败，使用默认第1关数据\");\n            const defaultLevel: LevelStruct = {\n                level: [\n                    // 瓶子1：位置(-150, 0)，颜色[1, 1, 2, 2] (红红橙橙)\n                    { position: { x: -150, y: 0 }, colors: [1, 1, 2, 2], hideCnt: 0, ad: false },\n                    // 瓶子2：位置(150, 0)，颜色[2, 2, 1, 1] (橙橙红红)\n                    { position: { x: 150, y: 0 }, colors: [2, 2, 1, 1], hideCnt: 0, ad: false },\n                    // 瓶子3：位置(0, 0)，空瓶\n                    { position: { x: 0, y: 0 }, colors: [], hideCnt: 0, ad: false }\n                ]\n            };\n            this.resetLvData(defaultLevel);\n        }\n    }\n\n    /**\n     * 切换到上一关卡\n     * @remarks 当关卡数≤0时不执行操作\n     */\n    public preLevel() {\n        if (this.state.info.level <= 0) {\n            return;\n        }\n        this.state.info.level--;\n        this.state.save();\n    }\n\n    /**\n     * 切换到下一关卡\n     * 修改逻辑：限制只玩前3关 (0, 1, 2)，超过则回到第1关\n     */\n    public nextLevel() {\n        this.state.info.level++;\n        // 需求：只要前三个关卡。索引从0开始，所以大于2就重置回0\n        if (this.state.info.level > 1) {\n            this.state.info.level = 0;\n        }\n        this.state.save();\n    }\n\n    public resetLvData(save: LevelStruct) {\n        this.glasses = save.level;\n        // 确保数据存在\n        if (!this.glasses) {\n            this.glasses = [];\n            return;\n        }\n        // 重新排序，根据position.y\n        this.glasses.sort((a: GlassInfo, b: GlassInfo) => {\n            return b.position.y - a.position.y;\n        });\n    }\n\n}"]}